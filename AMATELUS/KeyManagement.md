# AMATELUS 秘密鍵ライフサイクル管理仕様

## 1. 概要

本仕様書は、AMATELUSプロトコルにおける秘密鍵の管理、特にスマートフォンの盗難・紛失・破損・乗っ取り・買い替えなどの緊急事態における対応フローを定義する。

### 1.1 対象シナリオ

1. **秘密鍵漏洩**: 盗難、乗っ取り、不正アクセスなど、秘密鍵が第三者に渡った可能性がある場合
2. **秘密鍵紛失**: スマートフォンの破損、紛失など、秘密鍵にアクセスできなくなった場合
3. **秘密鍵更新**: デバイス買い替え、マルチデバイス対応など、計画的な秘密鍵の更新
4. **本人死亡**: 秘密鍵への物理的アクセスが永久に失われる特殊ケース
5. **被後見人**: 成年後見制度により法的な保護が必要となった場合

### 1.2 基本原則

- **決定性の原則**: 秘密鍵が手元にある場合のみ、暗号学的に決定的な操作（失効要求の署名など）が可能
- **連絡可能性の限界**: Holderが連絡できたIssuerのみ対応可能。連絡できないIssuerは対応不可能
- **数学的安全性の限界**: 身分証明と紐づいていないDIDの紛失は、数学的に安全な復旧方法が存在しない

## 2. シナリオ分類

```
秘密鍵の問題
├─ 漏洩 (Leakage)
│  └─ 秘密鍵が手元にあり、第三者に渡った可能性がある
│     → 決定的な失効が可能
│
├─ 紛失 (Loss)
│  ├─ 悪用懸念あり (Suspected Abuse)
│  │  └─ 盗難、乗っ取りの可能性
│  │     → 漏洩と同じ手順
│  │
│  └─ 悪用懸念なし (No Abuse Concern)
│     └─ 破損、故障など
│        └─ 身分証明VCあり
│           → 信頼継承フロー (Trust Inheritance)
│        └─ 身分証明VCなし
│           → VC再発行は実質不可能
│
├─ 更新 (Update)
│  └─ 新旧の秘密鍵が両方手元にある
│     → マルチデバイス対応を応用
│
├─ 本人死亡 (Death)
│  ├─ 家族なし
│  │  └─ 自治体が法的手順で戸籍処理時にVC失効
│  │     → 自治体VCのみ失効可能、民間は不可能
│  │
│  └─ 家族あり
│     └─ 自治体で代理VC発行 → 民間Issuerに失効依頼
│        → 他者依存で実行されない可能性大
│        → しかし損害は極めて限定的（秘密鍵使用不可能）
│
└─ 被後見人 (Guardianship)
   └─ 成年後見制度により制限行為能力者となった場合
      ├─ 後見登記時に自治体がVC発行記録を照合
      │  └─ VCを失効リストに追加（オプション）
      │
      ├─ 自治体が後見人VCを発行
      │  └─ 後見人が各Issuerに失効依頼
      │  └─ 後見人が契約取り消し可能
      │
      └─ Verifierが後見確認フロー実装
         └─ 高額契約は後見人承認必須
         └─ 小額取引は継続可能（日用品など）
```

## 3. 秘密鍵漏洩への対応フロー

### 3.1 前提条件

- ✅ 旧秘密鍵（漏洩した可能性がある鍵）が手元にある
- ✅ 旧秘密鍵で署名操作が可能
- ⚠️ 第三者が旧秘密鍵のコピーを持っている可能性がある

### 3.2 対応手順

#### Step 1: 緊急対応の開始

```
Holder側の操作:
1. 新しい秘密鍵ペア (newDID, newSK) を生成
2. 旧秘密鍵 (oldSK) を用いて「失効要求署名」を作成
```

#### Step 2: 全Issuerへの失効要求

Holderは、過去にVCを発行してもらった**全てのIssuer**に対して以下を送信：

```json
{
  "requestType": "revocationDueToLeakage",
  "oldDID": "did:amatelus:old123...",
  "newDID": "did:amatelus:new456...",
  "timestamp": "2025-10-14T10:30:00Z",
  "revocationReason": "秘密鍵漏洩の可能性",
  "signatureByOldKey": "署名(oldSK, hash(oldDID || newDID || timestamp))"
}
```

**暗号学的保証**:
- `signatureByOldKey`により、旧秘密鍵の正当な所有者による要求であることを**決定的に**証明可能
- 第三者は`signatureByOldKey`を偽造できない（Dilithium2の署名安全性）

#### Step 3: Issuer側の処理

各Issuerは以下を実行：

```
1. signatureByOldKeyの検証
   → 失敗した場合は要求を拒否

2. 該当oldDIDで発行した全VCを失効リストに追加
   → MerkleRevocationListを更新
   → 新バージョンのMerkle Rootを公開

3. oldDIDからの新規VC発行要求を永久拒否
   → DIDブラックリストにoldDIDを追加

4. (オプション) newDIDへのVC再発行
   → Issuerのポリシーに従って判断
   → 本人確認が必要な場合は追加手続きを要求
```

#### Step 4: 失効完了の確認

```
Holder側の確認作業:
1. 各IssuerのMerkleRevocationListを確認
   → 自分のVCが失効済みであることを確認

2. 連絡できなかったIssuerのリスト作成
   → これらのVCは失効不可能
   → 悪用リスクが残る
```

### 3.3 タイムライン

```
T=0:    秘密鍵漏洩を検知
T=+5分:  新鍵生成、失効要求署名作成
T=+30分: 全Issuerへ失効要求送信
T=+1時間: Issuerが失効処理を完了（目標SLA）
T=+24時間: 失効完了を確認、newDIDでVC再発行開始
```

### 3.4 セキュリティ特性

| 特性 | 保証レベル | 根拠 |
|------|-----------|------|
| 旧VCの失効 | **決定的** | 暗号署名による証明 |
| 旧DIDの受付拒否 | **決定的** | Issuerがブラックリスト管理 |
| 連絡できないIssuerのVC | **保証なし** | Issuerに連絡できない場合は対応不可能 |
| 第三者による悪用防止 | **時間依存** | Issuerの失効処理速度に依存 |

## 4. 秘密鍵紛失への対応フロー（悪用懸念あり）

### 4.1 シナリオ

- スマートフォンの盗難
- マルウェア感染による乗っ取り
- 紛失したデバイスが悪意ある第三者の手に渡った可能性

### 4.2 対応手順

**→ Section 3の「秘密鍵漏洩への対応フロー」と同一**

ただし、以下の違いがある：

```diff
前提条件:
- ❌ 旧秘密鍵が手元にない（紛失している）
+ ✅ バックアップから旧秘密鍵を復元できる場合
     → Section 3の手順を実行

+ ❌ バックアップもない場合
     → Section 5の「信頼継承フロー」へ
```

### 4.3 重要な注意点

旧秘密鍵にアクセスできない場合：

```
⚠️ 暗号学的に決定的な失効が不可能
   → Issuerは要求者が本人かどうか判断できない
   → Issuerのポリシーに従った本人確認が必要
   → 時間がかかり、悪用のリスクが高い
```

## 5. 秘密鍵紛失への対応フロー（信頼継承）

### 5.1 前提条件

- ❌ 旧秘密鍵が手元にない（破損、故障など）
- ✅ 悪用の懸念はない（第三者の手には渡っていない）
- ✅ 新しい秘密鍵ペア (newDID, newSK) を生成済み

### 5.2 ケースA: 身分証明VCがある場合

#### 5.2.1 信頼継承の原理

```
旧DID (oldDID)
  └─ 身分証明VC (例: 運転免許証VC)
      └─ Issuer = 警察署 or 市役所
      └─ 実世界の身分証明書と紐づいている

↓ 信頼継承

新DID (newDID)
  └─ DID移行証明VC (DIDMigrationVC)
      └─ Issuer = 警察署 or 市役所
      └─ oldDID と newDID の同一人物性を証明
```

#### 5.2.2 対応手順

**Step 1: 実世界での本人確認**

```
Holder → 市役所 or 警察署

持参するもの:
1. 実物の身分証明書（運転免許証、マイナンバーカードなど）
2. 新しいDID (newDID)
3. 旧DIDの情報（可能であれば）
```

**Step 2: Issuerによる記録照合**

```
Issuer側の処理:
1. 実物の身分証明書で本人確認
   → 顔写真、生年月日、住所などを確認

2. 過去のVC発行記録を検索
   → 実物の身分証明書番号をキーに検索
   → oldDIDとの紐付けを確認

3. 本人確認が成功した場合
   → DID移行証明VCの発行へ進む
```

**Step 3: DID移行証明VCの発行**

```json
{
  "@context": ["https://www.w3.org/2018/credentials/v1"],
  "type": ["VerifiableCredential", "DIDMigrationCredential"],
  "issuer": "did:amatelus:police-station-tokyo",
  "issuanceDate": "2025-10-14T11:00:00Z",
  "credentialSubject": {
    "id": "did:amatelus:new456...",
    "oldDID": "did:amatelus:old123...",
    "migrationType": "trustInheritance",
    "migrationReason": "デバイス破損による秘密鍵紛失",
    "verificationMethod": "実物身分証明書による本人確認",
    "identityDocument": {
      "type": "DriversLicense",
      "documentNumber": "123456789012",
      "issuerName": "東京都公安委員会",
      "verifiedAt": "2025-10-14T10:30:00Z"
    }
  },
  "proof": {
    "type": "Dilithium2Signature2025",
    "created": "2025-10-14T11:00:00Z",
    "proofPurpose": "assertionMethod",
    "verificationMethod": "did:amatelus:police-station-tokyo#key-1",
    "signature": "..."
  }
}
```

**Step 4: 他のIssuerへのVC再発行依頼**

```
Holder → 各Issuer

提示するもの:
1. DID移行証明VC (DIDMigrationVC)
2. 新しいDID (newDID) で生成したZKP

Issuerの判断:
- DIDMigrationVCを検証
- 発行元Issuer（警察署・市役所）の信頼性を確認
- Issuerのポリシーに従ってVC再発行を判断
```

#### 5.2.3 セキュリティ特性

| 特性 | 保証レベル | 根拠 |
|------|-----------|------|
| 本人性の証明 | **高** | 実物身分証明書による対面確認 |
| DID移行の正当性 | **高** | 信頼されたIssuer（警察署・市役所）による証明 |
| 他Issuerの受け入れ | **ポリシー依存** | 各Issuerの判断による |
| 旧VCの失効 | **不可能** | 旧秘密鍵がないため決定的な失効は不可能 |

### 5.3 ケースB: 身分証明VCがない場合

#### 5.3.1 問題点

```
❌ 数学的に安全な復旧方法が存在しない

理由:
1. 旧秘密鍵による署名ができない
   → 暗号学的に本人性を証明できない

2. 実世界の身分証明との紐付けがない
   → Issuerは「誰が」oldDIDの所有者だったか分からない

3. Issuerごとに異なるポリシーが必要
   → 一貫性のある手順が存在しない
```

#### 5.3.2 Issuerのポリシー例

各Issuerは独自のポリシーを策定する必要がある：

**ケース1: 大学の成績証明書VC**

```
Issuerポリシー:
- 学生証の再発行手続きに準じる
- 窓口で学生証を提示
- 顔写真と本人を照合
- 過去の成績証明書発行記録と照合
- 新DIDで成績証明書VCを再発行
```

**ケース2: オンラインサービスの会員証VC**

```
Issuerポリシー:
- アカウント復旧手続きに準じる
- 登録メールアドレスへの確認コード送信
- 秘密の質問による本人確認
- 過去の利用履歴との整合性確認
- 新DIDで会員証VCを再発行
```

**ケース3: 匿名サービスのVC**

```
Issuerポリシー:
- 本人確認手段がない
- VC再発行は不可能
- Holderは新規登録から再開する必要がある
```

#### 5.3.3 現実的な結論

```
⚠️ 身分証明と紐づいていないDIDを紛失した場合、
   VC再発行は実質的に不可能と考えるべき

推奨される予防策:
1. 必ず身分証明VCを最初に取得する
2. 秘密鍵のバックアップを複数箇所に保管
3. マルチデバイス対応を活用（Section 6）
4. 定期的な秘密鍵更新（Section 6）
```

## 6. 秘密鍵更新フロー（マルチデバイス対応）

### 6.1 前提条件

- ✅ 旧秘密鍵 (oldSK) が手元にある
- ✅ 新秘密鍵 (newSK) を生成済み
- ✅ 両方の秘密鍵で署名操作が可能
- ✅ 計画的な更新（緊急事態ではない）

### 6.2 ユースケース

1. **デバイス買い替え**: 新しいスマートフォンに移行
2. **マルチデバイス対応**: PCとスマートフォンで同じDIDを使用
3. **定期的な鍵更新**: セキュリティポリシーに従った鍵ローテーション
4. **バックアップデバイス**: 紛失に備えた予備デバイスの準備

### 6.3 対応手順

#### Step 1: 新旧の関連付け証明

```
Holder側の操作:
1. 新しい秘密鍵ペア (newDID, newSK) を生成

2. 双方向署名による関連付け証明を作成:
   - signatureByOldKey = sign(oldSK, hash(oldDID || newDID || timestamp))
   - signatureByNewKey = sign(newSK, hash(newDID || oldDID || timestamp))
```

#### Step 2: 各IssuerへのDID更新通知

```json
{
  "requestType": "didUpdate",
  "oldDID": "did:amatelus:old123...",
  "newDID": "did:amatelus:new456...",
  "timestamp": "2025-10-14T10:30:00Z",
  "updateReason": "デバイス買い替え",
  "transitionPeriod": "30days",
  "signatureByOldKey": "...",
  "signatureByNewKey": "...",
  "requestedAction": "issueNewVCWithNewDID"
}
```

**暗号学的保証**:
- 両方の署名により、oldDIDとnewDIDの所有者が同一人物であることを**決定的に**証明

#### Step 3: Issuer側の処理（柔軟な対応）

```
Issuerの選択肢:

Option A: 新DIDで新しいVCを発行
  → newDIDをcredentialSubject.idとする新VCを発行
  → 旧VCは保持（まだ有効）

Option B: 旧VCの有効期限を延長しない
  → 次回更新時にnewDIDで発行
  → 移行期間を設ける

Option C: DID更新証明VCを発行
  → oldDIDとnewDIDの関連を証明するVCを発行
  → 他のVerifierがこの関連を検証可能
```

#### Step 4: 移行期間の管理

```
移行期間中（例: 30日間）:
- oldDIDのVCも有効
- newDIDのVCも有効
- Holderはどちらでも使用可能

移行期間終了後:
- oldDIDのVCを失効（オプション）
- newDIDのみを使用
```

### 6.4 マルチデバイスシナリオ

#### シナリオ: PCとスマートフォンで同じDIDを使用

```
デバイスA (スマートフォン):
  DID: did:amatelus:user123...
  秘密鍵: SK_mobile

デバイスB (PC):
  DID: did:amatelus:user123...
  秘密鍵: SK_pc

問題:
❌ 同じ秘密鍵を複数デバイスで共有するのはセキュリティリスク
✅ デバイスごとに異なる秘密鍵を使い、DIDを更新する方が安全
```

**推奨アプローチ**:

```
1. 各デバイスに固有のDIDを割り当て
   - DID_mobile: スマートフォン用
   - DID_pc: PC用

2. Section 6.3の手順でDIDを更新
   - 旧DID → DID_mobile
   - 旧DID → DID_pc

3. 各Issuerから両方のDIDでVCを発行してもらう
   - Issuerには「同一人物の別デバイス」と説明
   - 双方向署名で同一人物性を証明
```

### 6.5 セキュリティ特性

| 特性 | 保証レベル | 根拠 |
|------|-----------|------|
| 新旧DIDの同一人物性 | **決定的** | 双方向暗号署名による証明 |
| 新VCの発行 | **決定的** | Issuerが署名検証後に発行 |
| 旧VCの継続利用 | **Issuerポリシー依存** | 移行期間の設定による |
| マルチデバイス対応 | **可能** | 各デバイスに固有DIDを割り当て |

## 7. セキュリティ考察

### 7.1 攻撃シナリオと対策

#### 攻撃1: 旧秘密鍵による悪用（漏洩後）

```
攻撃者の行動:
- 漏洩した旧秘密鍵を使ってZKPを生成
- 失効前の時間窓で旧VCを悪用

対策:
✅ Issuerの迅速な失効処理（目標: 1時間以内）
✅ Verifierが最新のMerkleRevocationListを使用
✅ MAX_VERSION_LAGによる古いMerkle Rootの拒否
⚠️ 失効処理完了までの時間窓は脆弱性として残る
```

#### 攻撃2: 偽装DID移行（紛失時）

```
攻撃者の行動:
- 他人のoldDIDを知っている
- 自分のnewDIDとoldDIDの関連を偽装
- Issuerに「DID移行した」と主張してVC再発行を依頼

対策:
✅ 旧秘密鍵による署名が必要（Section 3, 6）
✅ 身分証明VCがある場合は実物確認（Section 5.2）
❌ 身分証明VCがない場合は防御困難（Section 5.3）
```

#### 攻撃3: 中間者攻撃（通信路）

```
攻撃者の行動:
- HolderとIssuer間の通信を傍受
- 失効要求を改ざんまたは遅延

対策:
✅ TLS/HTTPSによる通信路の暗号化
✅ 署名による改ざん検知
⚠️ DDoS攻撃による遅延は防げない
```

### 7.2 数学的安全性の限界

```
定理: 身分証明と紐づいていないDIDの安全な復旧は不可能

証明:
1. 旧秘密鍵がない場合、暗号署名による本人性証明は不可能
   （Dilithium2署名方式の安全性定義より）

2. 実世界の身分証明との紐付けがない場合、
   「誰が」oldDIDの所有者だったかを検証する手段が存在しない

3. したがって、Issuerは数学的に安全な方法で本人確認できない
   （情報理論的に不可能）

結論: Section 5.3のケースでは、VC再発行は実質不可能
```

### 7.3 連絡可能性の限界

```
問題: Holderが連絡できないIssuerは対応不可能

シナリオ:
- IssuerのサービスがX年前に終了していた
- Issuerの連絡先が変わっていた
- Issuerが倒産・廃業していた

結果:
❌ これらのIssuerが発行したVCは失効できない
⚠️ 悪用リスクが永続的に残る

推奨事項:
- Issuerは長期的なサービス継続を保証すべき
- Issuerは連絡先の変更を公開すべき
- Holderは定期的にVCを更新すべき（Section 6）
```

## 8. Issuerのポリシー策定ガイドライン

### 8.1 失効要求への対応ポリシー

Issuerは以下のポリシーを策定すべき：

#### 8.1.1 対応時間のSLA

```yaml
失効要求の受付から失効完了までの目標時間:
  - 緊急度: 高（漏洩・盗難）
    目標: 1時間以内
    最大: 24時間以内

  - 緊急度: 中（紛失）
    目標: 24時間以内
    最大: 7日以内

  - 緊急度: 低（計画的更新）
    目標: 7日以内
    最大: 30日以内
```

#### 8.1.2 本人確認の要件

```yaml
秘密鍵による署名あり (Section 3, 6):
  本人確認: 不要（署名検証のみ）
  処理: 自動化可能

秘密鍵による署名なし (Section 5):
  身分証明VCあり:
    本人確認: 実物身分証明書による対面確認
    処理: 手動（窓口対応）

  身分証明VCなし:
    本人確認: Issuer独自のポリシー
    例:
      - 学生証・社員証の提示
      - 登録メールアドレスの確認
      - 秘密の質問
      - 過去の利用履歴の照合
    処理: 手動（ケースバイケース）
```

### 8.2 DID移行証明VCの信頼ポリシー

他のIssuerが発行したDIDMigrationVCを受け入れるかどうかの判断基準：

```yaml
信頼するIssuerのホワイトリスト:
  - did:amatelus:police-station-*
  - did:amatelus:city-hall-*
  - did:amatelus:national-id-center

検証項目:
  1. DIDMigrationVCの署名検証
  2. Issuerが信頼リストに含まれているか
  3. DIDMigrationVCの有効期限（例: 発行から1年以内）
  4. migrationType が "trustInheritance"
  5. identityDocument が存在し、verifiedAt が最近

受け入れ判断:
  - 全ての検証項目が満たされている → 自動承認
  - 一部の検証項目が満たされていない → 手動審査
  - Issuerが信頼リストにない → 拒否
```

### 8.3 移行期間の設定

```yaml
DID更新時の移行期間:
  推奨: 30日間
  最小: 7日間
  最大: 90日間

移行期間中:
  - 旧DIDのVCも有効
  - 新DIDのVCも有効

移行期間終了後:
  - 旧DIDのVCを失効（オプション）
  - Holderに通知を送信
```

### 8.4 Issuer側の記録保持

```yaml
記録すべき情報:
  - VC発行履歴
    - DID
    - 発行日時
    - VC ID
    - 本人確認方法
    - (可能であれば) 実世界の身分証明書番号

  - 失効要求履歴
    - 要求日時
    - 要求理由
    - 署名検証結果
    - 処理完了日時

  - DID移行履歴
    - oldDID
    - newDID
    - 移行日時
    - 本人確認方法

保持期間:
  - 最低: VC有効期限 + 1年
  - 推奨: 永久保存（プライバシー法令に準拠）
```

## 9. 実装推奨事項

### 9.1 Holder側

```yaml
秘密鍵管理:
  - デバイスのセキュアストレージ（Keychain、TEE）に保存
  - バックアップを複数箇所に保管（暗号化して別デバイス、紙、等）
  - 定期的なバックアップの動作確認

DID管理:
  - 最初に身分証明VCを取得（Section 5.2）
  - 定期的なDID更新（例: 1年ごと、Section 6）
  - 複数デバイスでの利用を考慮（マルチDID、Section 6.4）

緊急時の準備:
  - 全Issuerの連絡先リストを保持
  - 失効要求のテンプレートを準備
  - 緊急対応フローを事前に確認
```

### 9.2 Issuer側

```yaml
システム実装:
  - 失効要求APIの提供
  - 自動署名検証の実装
  - MerkleRevocationListの迅速な更新
  - 24時間365日の受付体制（高SLAの場合）

ポリシー文書:
  - Section 8の各ポリシーを公開
  - Holderが事前に確認できるようにする
  - 法的な免責事項を含める

本人確認体制:
  - 窓口での対面確認プロセス（Section 5.2）
  - オンライン本人確認の代替手段（Section 5.3）
  - スタッフのトレーニング
```

### 9.3 Verifier側

```yaml
失効確認:
  - 常に最新のMerkleRevocationListを使用
  - MAX_VERSION_LAGを適切に設定（推奨: 5）
  - ネットワーク障害時のフォールバック処理

DID移行対応:
  - DIDMigrationVCの検証実装
  - 信頼するIssuerのホワイトリスト管理（Section 8.2）
  - 移行期間中の旧新両DID受け入れ
```

## 10. 本人死亡時の対応

### 10.1 前提条件とシナリオ

本人が死亡した場合、秘密鍵への物理的アクセスが永久に失われる特殊なケース。

```
重要な特性:
✅ 秘密鍵は誰もアクセスできない（本人死亡のため）
✅ 悪用リスクは実質的にゼロ（秘密鍵が使用不可能）
⚠️ 手続きは他者（家族・自治体）に依存
⚠️ ほとんどの場合、適切に実行されない可能性が高い
✅ しかし放置してもIssuer/Verifierに損害は発生しない
```

### 10.2 ケースA: 家族がいない場合

#### 10.2.1 自治体による法的手続き

```
死亡処理の流れ:
1. 身元不明の遺体 → 警察が身元確認
2. 戸籍・住民票の死亡処理
3. 遺産管理・財産処分
```

#### 10.2.2 自治体によるVC失効処理

自治体（市役所・警察署）がIssuerとして身分証明VCを発行していた場合：

```yaml
自治体Issuerの処理:
  1. 戸籍システムと連携
     → 死亡届受理時に自動的にVC発行記録を検索

  2. VC発行記録の確認
     → 死亡者のDIDを特定
     → 実物身分証明書番号からDID検索

  3. MerkleRevocationListの更新
     → 該当DIDで発行した全VCを失効リストに追加
     → 新バージョンのMerkle Rootを公開

  4. (オプション) 死亡証明VCの発行
     → 他のIssuerが参照できる死亡情報
     → プライバシー保護を考慮した設計
```

**実装例: 死亡証明VC**

```json
{
  "@context": ["https://www.w3.org/2018/credentials/v1"],
  "type": ["VerifiableCredential", "DeathCertificate"],
  "issuer": "did:amatelus:city-hall-tokyo",
  "issuanceDate": "2025-10-14T15:00:00Z",
  "credentialSubject": {
    "id": "did:amatelus:deceased-person-123...",
    "status": "deceased",
    "deathDate": "2025-10-10",
    "deathRegistrationNumber": "令和7年第12345号",
    "registrar": "東京都新宿区",
    "revokeAllVCs": true
  },
  "proof": {
    "type": "Dilithium2Signature2025",
    "created": "2025-10-14T15:00:00Z",
    "proofPurpose": "assertionMethod",
    "verificationMethod": "did:amatelus:city-hall-tokyo#key-1",
    "signature": "..."
  }
}
```

#### 10.2.3 民間Issuerの限界

```
問題:
❌ 民間Issuerは死亡情報にアクセスできない
   → 戸籍システムへのアクセス権がない
   → 死亡に気づく手段がない

結果:
❌ 民間IssuerのVCは失効不可能
   → 死亡者のVCが有効期限まで残り続ける

セキュリティ影響:
✅ しかし損害は発生しない
   理由:
   - 秘密鍵が永久に失われているため、ZKP生成不可能
   - 誰も死亡者のVCを使用できない
   - 悪用リスクは実質的にゼロ
```

### 10.3 ケースB: 家族がいる場合

#### 10.3.1 死亡手続きと代理VC

家族が自治体で死亡手続きを行う際、代理権限を証明するVCを発行：

**Step 1: 自治体での死亡手続き**

```
遺族 → 市役所

持参するもの:
1. 死亡診断書
2. 戸籍謄本
3. 遺族の身分証明書
4. (あれば) 故人の遺品からDID情報
```

**Step 2: 代理VC（Legal Representative VC）の発行**

```json
{
  "@context": ["https://www.w3.org/2018/credentials/v1"],
  "type": ["VerifiableCredential", "LegalRepresentativeCredential"],
  "issuer": "did:amatelus:city-hall-tokyo",
  "issuanceDate": "2025-10-14T16:00:00Z",
  "credentialSubject": {
    "id": "did:amatelus:family-member-456...",
    "representativeOf": "did:amatelus:deceased-person-123...",
    "relationship": "配偶者",
    "authority": "死亡に伴うVC失効手続き",
    "deceasedInfo": {
      "deathDate": "2025-10-10",
      "deathRegistrationNumber": "令和7年第12345号"
    },
    "verificationMethod": "実物身分証明書および戸籍謄本による確認"
  },
  "proof": {
    "type": "Dilithium2Signature2025",
    "created": "2025-10-14T16:00:00Z",
    "proofPurpose": "assertionMethod",
    "verificationMethod": "did:amatelus:city-hall-tokyo#key-1",
    "signature": "..."
  }
}
```

#### 10.3.2 民間Issuerへの失効依頼

**Step 3: 遺族による各Issuerへの連絡**

```
遺族 → 各民間Issuer

提示するもの:
1. 代理VC (LegalRepresentativeCredential)
2. (あれば) 死亡証明VC (DeathCertificate)
3. 遺族自身のDIDで生成したZKP

依頼内容:
- 故人のDID (did:amatelus:deceased-person-123...) で発行された全VCの失効
- 失効理由: 本人死亡
```

**Step 4: Issuer側の処理**

```yaml
民間Issuerの検証手順:
  1. 代理VCの署名検証
     → 発行元が信頼できる自治体か確認

  2. 代理権限の確認
     → authority に "死亡に伴うVC失効手続き" が含まれるか

  3. (オプション) 死亡証明VCの検証
     → 死亡事実の二重確認

  4. 失効処理の実行
     → 該当DIDで発行した全VCを失効リストに追加
     → MerkleRevocationListを更新
```

#### 10.3.3 現実的な課題

```
課題1: 遺族がDID情報を知らない
  → 故人がDIDを使用していたことを知らない
  → どのIssuerにVCを発行してもらったか不明
  → 手続きが事実上不可能

課題2: 遺族が手続きをしない
  → 法的義務ではないため、多くの場合放置される
  → 民間IssuerのVCは失効されないまま残る

課題3: Issuerの対応負担
  → 代理VCの検証に人手が必要
  → 死亡証明の真偽判定が困難
  → コストに見合わない可能性

結論:
⚠️ ほとんどの場合、適切に実行されない
   → しかしセキュリティ影響は軽微（次のセクション参照）
```

### 10.4 セキュリティ影響の分析

#### 10.4.1 死亡者のVCが失効されない場合の影響

```
シナリオ: 民間IssuerのVCが死亡後も失効されずに残る

攻撃可能性の分析:
❌ 攻撃者A: 秘密鍵を盗もうとする
   → 本人が死亡しているため秘密鍵は使用不可能
   → ZKP生成不可能
   → 攻撃失敗

❌ 攻撃者B: VCを偽造しようとする
   → IssuerのDilithium2署名が必要
   → 署名偽造は計算量的に困難
   → 攻撃失敗

❌ 攻撃者C: 遺族が秘密鍵を見つけて悪用
   → 本人死亡のため、使用は不正
   → しかし暗号学的には正当なZKPが生成可能
   → ⚠️ このケースのみリスクあり
```

#### 10.4.2 遺族による秘密鍵悪用のリスク評価

```
ケース: 遺族が故人の秘密鍵を発見して悪用

前提条件:
1. ✅ 遺族が故人のデバイスにアクセス
2. ✅ 秘密鍵のバックアップを発見
3. ✅ パスワード/PINを知っている or 解除できた

攻撃シナリオ:
- 故人のDIDで本人になりすます
- VCを使って不正な利益を得る

対策:
✅ 自治体Issuerの身分証明VCは必ず失効される
   → なりすましの主要手段は防止

⚠️ 民間IssuerのVCは残る可能性
   → 限定的な悪用リスク

✅ 有効期限が比較的短い（推奨: 1年）
   → 時間経過で自然に失効

✅ Verifierが定期的な再認証を要求
   → 高額取引では追加の本人確認
   → なりすまし検知の機会
```

#### 10.4.3 損害評価

```yaml
Issuer側の損害:
  直接的損害: なし
    理由: Issuerは証明書を発行しただけで、金銭的損失なし

  評判への影響: 軽微
    理由: 死亡者のVC管理は社会的に許容される範囲

Verifier側の損害:
  直接的損害: 限定的
    理由:
      - 身分証明VCは失効済み（自治体処理）
      - 民間VCのみでは高リスク取引は不可
      - 有効期限により長期的リスクは低下

  防止策: 追加の本人確認
    - 高額取引では生体認証を併用
    - 定期的な再認証を要求

社会全体の損害:
  評価: 極めて軽微
    理由:
      - 秘密鍵が使用不可能なケースが大多数
      - 遺族による悪用は稀（動機が弱い）
      - 自治体による身分証明VC失効で主要リスクは防止
```

**結論**:
```
✅ 本人死亡時のVC失効が不完全でも、損害は極めて限定的
✅ セキュリティアーキテクチャは本人死亡シナリオに対して頑健
⚠️ ただし遺族による悪用リスクはゼロではない
✅ Verifierの追加認証で更にリスク軽減可能
```

### 10.5 Issuerのポリシー推奨事項

#### 10.5.1 自治体Issuerのポリシー

```yaml
必須事項:
  ✅ 戸籍システムとの連携
     - 死亡届受理時にVC発行記録を自動検索
     - 該当DIDのVCを失効リストに追加

  ✅ 代理VCの発行体制
     - 遺族からの依頼に対応
     - 本人確認と戸籍確認を実施
     - LegalRepresentativeCredentialを発行

  ✅ 死亡証明VCの発行（オプション）
     - 他のIssuerが参照可能な形式
     - プライバシー保護を考慮

推奨事項:
  ✅ 定期的な戸籍照合
     - 週次 or 月次でVC発行者の生存確認
     - 死亡者を自動検出して失効処理

  ✅ APIの提供
     - 民間Issuerが死亡情報を照会可能なAPI
     - プライバシー保護とアクセス制御が必要
```

#### 10.5.2 民間Issuerのポリシー

```yaml
推奨事項（義務ではない）:
  ✅ 代理VCの受け入れ体制
     - 遺族からの失効依頼に対応
     - 代理VC検証プロセスの整備

  ⚠️ 短い有効期限の設定
     - 推奨: 1年以内
     - 死亡後の悪用期間を限定

  ⚠️ 高リスク取引での追加認証
     - 生体認証の併用
     - 定期的な再認証要求

現実的な判断:
  ✅ 完璧な失効処理は期待しない
     - 損害が極めて限定的
     - コストと効果のバランスを考慮
     - ベストエフォートで対応

  ✅ セキュリティ設計の多層化
     - VC失効に過度に依存しない
     - Verifier側での追加認証を推奨
     - 有効期限を適切に設定
```

#### 10.5.3 記録保持のポリシー

```yaml
法的要件との整合性:
  - 個人情報保護法: 本人死亡後も一定期間の保持が必要
  - 相続法: 遺族による情報開示請求に対応
  - 会計法: 取引記録の保持義務

推奨保持期間:
  VC発行記録:
    - 本人死亡確認後 + 5年間
    - または VC有効期限 + 1年間（いずれか長い方）

  失効記録:
    - 永久保存（MerkleRevocationList）
    - 過去の検証を可能にするため

  代理VC発行記録:
    - 本人死亡確認後 + 10年間
    - 法的紛争に備えるため
```

## 11. 被後見人となった場合の対応

### 11.1 前提条件とシナリオ

成年後見制度により被後見人（制限行為能力者）となった場合の対応。

```
重要な特性:
✅ 本人は生存しており秘密鍵にアクセス可能
⚠️ 判断能力が不十分なため不適切な契約をする可能性
✅ 後見人が法的に代理権限を持つ
⚠️ 物理的にスマホ使用を止めることはできない
✅ 後見人VCで事後的な契約取り消しが可能
```

**本人死亡との違い**:
```diff
本人死亡:
- ❌ 秘密鍵へのアクセス: 不可能
- ✅ 悪用リスク: 実質的にゼロ
- ⚠️ VC失効: 不完全でも損害は軽微

被後見人:
+ ✅ 秘密鍵へのアクセス: 可能（本人がデバイス所持）
+ ⚠️ 悪用リスク: あり（不適切な契約の可能性）
+ ✅ VC失効: 後見人が依頼可能
+ ✅ 契約取り消し: 後見人VCで可能
```

### 11.2 成年後見制度の開始時フロー

#### 11.2.1 家庭裁判所による後見開始審判

```
法的手続き:
1. 申立て（本人・配偶者・四親等内親族・検察官など）
2. 家庭裁判所による審理
3. 本人の判断能力の鑑定
4. 後見開始の審判
5. 成年後見人の選任（弁護士・司法書士・親族など）
```

#### 11.2.2 自治体による後見登記と通知

後見開始後、自治体（市役所・家庭裁判所）は法務局の後見登記と連携：

```yaml
自治体Issuerの処理:
  1. 後見登記システムと連携
     → 後見開始審判確定時にVC発行記録を検索

  2. VC発行記録の確認
     → 被後見人のDIDを特定
     → 実物身分証明書番号からDID検索

  3. (オプション) MerkleRevocationListへの追加
     → 被後見人の身分証明VCを失効リストに追加
     → ただし完全失効ではなく「後見中」とマーク

  4. 後見人VCの発行
     → 成年後見人に対してGuardianCredentialを発行
```

### 11.3 後見人VC（Guardian Credential）の発行

**Step 1: 後見人の本人確認**

```
成年後見人 → 市役所 or 家庭裁判所

持参するもの:
1. 後見人自身の身分証明書
2. 後見開始審判書の謄本
3. 成年後見登記事項証明書
4. (あれば) 被後見人のDID情報
```

**Step 2: 後見人VCの発行**

```json
{
  "@context": ["https://www.w3.org/2018/credentials/v1"],
  "type": ["VerifiableCredential", "GuardianCredential"],
  "issuer": "did:amatelus:city-hall-tokyo",
  "issuanceDate": "2025-10-14T14:00:00Z",
  "credentialSubject": {
    "id": "did:amatelus:guardian-789...",
    "guardianOf": "did:amatelus:ward-123...",
    "guardianType": "成年後見人",
    "relationship": "弁護士",
    "authority": [
      "VC失効依頼",
      "DIDブラックリスト登録依頼",
      "契約取り消し",
      "財産管理代理"
    ],
    "wardInfo": {
      "courtDecisionDate": "2025-10-01",
      "courtCaseNumber": "令和7年（家）第12345号",
      "registrationNumber": "令和7年後見第67890号",
      "guardianshipStartDate": "2025-10-01"
    },
    "verificationMethod": "後見開始審判書および登記事項証明書による確認",
    "expirationDate": "2026-10-14T23:59:59Z"
  },
  "proof": {
    "type": "Dilithium2Signature2025",
    "created": "2025-10-14T14:00:00Z",
    "proofPurpose": "assertionMethod",
    "verificationMethod": "did:amatelus:city-hall-tokyo#key-1",
    "signature": "..."
  }
}
```

**重要なフィールド**:
- `guardianOf`: 被後見人のDID
- `authority`: 後見人が行使できる権限のリスト
- `courtDecisionDate`: 審判確定日
- `registrationNumber`: 後見登記番号（検証用）
- `expirationDate`: 有効期限（1年ごとの更新を推奨）

### 11.4 後見人による対応フロー

#### 11.4.1 各Issuerへの通知

**Step 1: 後見開始の通知**

```
後見人 → 各Issuer（被後見人がVCを持つ全てのIssuer）

提示するもの:
1. 後見人VC (GuardianCredential)
2. 後見人自身のDIDで生成したZKP
3. (オプション) 後見開始審判書の写し

通知内容:
- 被後見人のDID (did:amatelus:ward-123...) が後見中であること
- 以下の対応を依頼:
  a. 被後見人のVCを失効リストに追加
  b. 被後見人のDIDをブラックリストに追加（新規VC発行拒否）
  c. 今後の契約は後見人の承認が必要
```

**Step 2: Issuer側の処理**

```yaml
Issuerの検証手順:
  1. 後見人VCの署名検証
     → 発行元が信頼できる自治体・家庭裁判所か確認

  2. 後見権限の確認
     → authority に "VC失効依頼" が含まれるか
     → guardianOf が該当DIDと一致するか

  3. (オプション) 後見登記の照会
     → 法務局APIで登記事項を確認（真正性の二重確認）

  4. 失効処理の実行（Issuerのポリシーによる）:
     Option A: 完全失効
       → MerkleRevocationListに追加
       → DIDをブラックリストに登録

     Option B: 条件付き有効
       → 「後見中」フラグを付与
       → Verifierに後見人承認を要求
       → 小額取引は継続可能（Issuerポリシー次第）

     Option C: 何もしない
       → Verifierが判断（次のセクション参照）
```

#### 11.4.2 被後見人によるスマホ使用の継続

```
現実的な問題:
⚠️ 被後見人はスマホとウォレットへのアクセスを持ち続ける
   → 物理的に使用を止めることはできない
   → 秘密鍵は被後見人のデバイスに保存されている
   → ZKPを生成して契約を試みることは可能

対策の限界:
❌ 技術的にウォレット使用を無効化することはできない
   → デバイスを取り上げない限り防止不可能
   → 成年後見制度は「保護」であり「拘束」ではない

現実的な対応:
✅ Issuerが新規VC発行を拒否（DIDブラックリスト）
✅ Issuerが既存VCを失効
✅ Verifierが後見人VCの存在を確認
✅ 後見人が事後的に契約を取り消し
```

### 11.5 契約取り消しフロー

被後見人が不適切な契約をした場合、後見人が事後的に取り消すことが可能。

#### 11.5.1 契約取り消しの法的根拠

```
民法 第9条（成年被後見人の法律行為）:
「成年被後見人の法律行為は、取り消すことができる。」

適用範囲:
✅ 被後見人が単独で行った契約は取消可能
✅ 日用品の購入など日常生活に関する行為は除外
⚠️ 後見人の同意を得た行為は有効
```

#### 11.5.2 取り消し手順

**Step 1: 契約の発見**

```
後見人の監督業務:
- 被後見人の財産状況を定期的に確認
- 不審な支出・契約を発見
- ZKPを使用した契約をVerifierに照会
```

**Step 2: Verifierへの取り消し通知**

```
後見人 → Verifier（契約相手）

提示するもの:
1. 後見人VC (GuardianCredential)
2. 取り消し対象の契約情報
3. 取り消し理由の説明

要求内容:
- 該当契約を無効とすること
- 既払金の返還
- 被後見人の個人情報削除
```

**Step 3: Verifier側の処理**

```yaml
Verifier の検証・対応:
  1. 後見人VCの署名検証
     → 発行元の信頼性を確認
     → authority に "契約取り消し" が含まれるか

  2. 契約時点の状況確認
     → 契約時に被後見人のDIDが使用されたか
     → 契約時に後見人の承認があったか

  3. 法的判断
     → 民法第9条に基づく取り消しの適法性を確認
     → 「日常生活に関する行為」に該当しないか

  4. 取り消し処理の実行
     → 契約を無効化
     → 返金処理
     → 該当DIDをブラックリストに追加（再発防止）
```

### 11.6 Verifierの後見確認フロー

Verifierは契約時に後見人VCの存在を確認すべき：

**推奨フロー**:

```yaml
契約時の確認手順:
  1. HolderからZKPを受け取る

  2. IssuerのMerkleRevocationListで失効確認
     → 通常の失効確認フロー（Section 9.3参照）

  3. (新規) 後見人VCの存在確認:
     a. 自治体IssuerのGuardianCredentialリストを照会
        → 該当DIDに後見人が登録されているか

     b. 後見人が存在する場合:
        Option A: 契約を拒否
          → 「成年後見中のため契約できません」

        Option B: 後見人の承認を要求
          → 後見人に連絡して承認を取得
          → 後見人のDIDで署名された承認書を要求

        Option C: 小額取引のみ許可
          → 日用品購入など（例: 1万円以下）
          → Verifierのポリシーに従う

  4. 後見人が存在しない場合:
     → 通常通り契約を進める
```

**実装例: 後見確認API**

```
GET /api/v1/guardianship/check/{did}

Response:
{
  "did": "did:amatelus:ward-123...",
  "underGuardianship": true,
  "guardian": {
    "did": "did:amatelus:guardian-789...",
    "type": "成年後見人",
    "contactInfo": "guardian@example.com",
    "guardianVC": {
      "id": "https://city-hall-tokyo.example.com/credentials/guardian/12345",
      "issuer": "did:amatelus:city-hall-tokyo",
      "issuedAt": "2025-10-14T14:00:00Z",
      "expiresAt": "2026-10-14T23:59:59Z"
    }
  },
  "restrictions": [
    "新規VC発行不可",
    "高額契約には後見人承認必須",
    "小額取引（1万円以下）のみ単独可能"
  ]
}
```

### 11.7 セキュリティ影響の分析

#### 11.7.1 被後見人による不適切な契約のリスク

```
シナリオ: 被後見人が判断能力不十分なまま契約

攻撃可能性の分析:
✅ 被後見人本人が秘密鍵を持つ
   → 暗号学的には正当なZKPを生成可能
   → Verifierは技術的に判別不可能

⚠️ 契約は法的に取り消し可能
   → 民法第9条による保護
   → しかし事後処理には時間とコストがかかる

対策:
✅ IssuerがVCを失効 or DIDをブラックリスト登録
   → 新規契約は技術的に防止可能

✅ Verifierが後見確認フローを実装
   → 契約時点で後見人の存在を検出
   → 高額契約を事前に拒否

✅ 後見人が定期的に監督
   → 不適切な契約を早期に発見
   → 速やかに取り消し手続き
```

#### 11.7.2 偽装後見人VCのリスク

```
攻撃シナリオ: 攻撃者が偽の後見人VCを使って他人のVCを失効させようとする

対策:
✅ 後見人VCは信頼された自治体・家庭裁判所が発行
   → Dilithium2署名により偽造困難

✅ Issuerが発行元を厳密に検証
   → ホワイトリストに含まれる発行元のみ信頼

✅ (推奨) 後見登記の照会
   → 法務局APIで後見登記を二重確認
   → registrationNumber の真正性を検証

結論:
✅ 暗号学的に安全（署名偽造は困難）
✅ 発行元検証により偽装は検出可能
```

#### 11.7.3 損害評価

```yaml
被後見人による不適切な契約の損害:

Issuer側の損害:
  直接的損害: なし
    理由: Issuerは証明書を発行しただけ

  評判への影響: 軽微
    理由: 後見人VCによる失効依頼に適切に対応すれば問題なし

Verifier側の損害:
  直接的損害: 中程度
    理由:
      - 契約取り消しによる返金処理のコスト
      - 商品・サービス提供済みの場合は回収困難
      - 事務処理の負担

  防止策:
    ✅ 契約時の後見確認フロー実装
    ✅ 高額契約では追加の本人確認
    ✅ 後見人承認の取得

被後見人本人への影響:
  保護効果: 高
    理由:
      - 不適切な契約から保護される
      - 財産が守られる
      - 後見人が適切に管理

社会全体の影響:
  評価: 成年後見制度との整合性が重要
    ✅ VCシステムが成年後見制度を技術的にサポート
    ⚠️ Verifierの理解と協力が必要
```

### 11.8 Issuerのポリシー推奨事項

#### 11.8.1 自治体Issuerのポリシー

```yaml
必須事項:
  ✅ 後見登記システムとの連携
     - 後見開始審判確定時にVC発行記録を自動検索
     - 該当DIDを「後見中」として記録

  ✅ 後見人VCの発行体制
     - 後見人からの依頼に対応
     - 後見開始審判書・登記事項証明書を厳密に確認
     - GuardianCredentialを発行

  ✅ 後見確認APIの提供
     - Verifierが後見状況を照会可能なAPI
     - リアルタイムの後見情報提供
     - プライバシー保護とアクセス制御

推奨事項:
  ✅ 定期的な後見登記照合
     - 月次でVC発行者の後見状況を確認
     - 新規後見開始を自動検出

  ✅ 後見終了時の処理
     - 後見終了審判時にVCを復活
     - 後見人VCを失効
```

#### 11.8.2 民間Issuerのポリシー

```yaml
推奨事項:
  ✅ 後見人VCの受け入れ体制
     - 後見人からの失効依頼に対応
     - 後見人VC検証プロセスの整備

  ✅ DIDブラックリストの実装
     - 後見中のDIDからの新規VC発行要求を拒否
     - 既存VCの失効処理

  ⚠️ 条件付き有効の検討
     - 小額利用は継続可能にする（Issuerポリシー次第）
     - 「後見中」フラグを付与してVerifierに判断を委ねる

検証手順:
  1. 後見人VCの署名検証
  2. 発行元が信頼リストに含まれるか
  3. authority に適切な権限が含まれるか
  4. (推奨) 後見登記APIで二重確認
```

#### 11.8.3 Verifierのポリシー

```yaml
必須事項:
  ✅ 後見確認フローの実装
     - 契約時に後見人VCの存在を確認
     - 自治体の後見確認APIを利用

  ✅ 後見中のDID処理ポリシー:
     高額契約（例: 10万円以上）:
       → 後見人の承認を必須とする

     中額取引（例: 1万円〜10万円）:
       → 警告表示して後見人に通知

     小額取引（例: 1万円以下）:
       → 許可する（日用品購入など）

  ✅ 契約取り消しへの対応
     - 後見人からの取り消し通知を速やかに処理
     - 返金・契約無効化の手順を整備

推奨事項:
  ✅ 後見人への通知機能
     - 契約成立時に後見人にメール/通知送信
     - 後見人が速やかに監督できるようにする

  ⚠️ 法務部門との連携
     - 民法第9条の適用基準を明確化
     - 取り消し対応のマニュアル整備
```

### 11.9 本人死亡との比較

| 特性 | 本人死亡 | 被後見人 |
|------|---------|---------|
| 秘密鍵へのアクセス | ❌ 不可能 | ✅ 可能（本人所持） |
| ZKP生成可能性 | ❌ 不可能 | ✅ 可能 |
| 悪用リスク | ✅ 実質ゼロ | ⚠️ あり（不適切な契約） |
| VC失効の緊急性 | ⚠️ 低い | ✅ 高い |
| 代理人の権限 | 遺族（相続関連） | 後見人（包括的財産管理） |
| 契約の法的効力 | - | ⚠️ 取消可能 |
| Verifierの対応 | 追加確認推奨 | 後見確認必須 |
| 損害の深刻度 | ✅ 軽微 | ⚠️ 中程度 |

**重要な違い**:
```
本人死亡:
✅ 秘密鍵が使用不可能 → 技術的に安全
⚠️ VC失効は「整理」の意味合い

被後見人:
⚠️ 秘密鍵が使用可能 → 技術的リスクあり
✅ VC失効は「保護」の意味合い
✅ 後見人VCによる能動的な管理が可能
✅ Verifierの後見確認フローが重要
```

## 12. まとめ

### 12.1 各シナリオの対応可能性

| シナリオ | 対応可能性 | 条件 |
|---------|-----------|------|
| 秘密鍵漏洩 | ✅ **決定的** | 旧秘密鍵が手元にある |
| 秘密鍵紛失（悪用懸念） | ✅ 決定的 | バックアップから旧鍵復元可能 |
| 秘密鍵紛失（悪用懸念） | ⚠️ 限定的 | バックアップなし、身分証明VCあり |
| 秘密鍵紛失（悪用懸念） | ❌ **不可能** | バックアップなし、身分証明VCなし |
| 秘密鍵紛失（悪用なし） | ✅ 可能 | 身分証明VCあり（信頼継承） |
| 秘密鍵紛失（悪用なし） | ❌ **実質不可能** | 身分証明VCなし |
| 秘密鍵更新 | ✅ **決定的** | 新旧両方の秘密鍵が手元にある |
| **本人死亡（家族なし）** | ⚠️ **限定的** | 自治体VCのみ失効可能、民間は不可能 |
| **本人死亡（家族あり）** | ⚠️ **限定的** | 遺族の協力次第、実行されない可能性大 |
| **被後見人** | ✅ **対応可能** | 後見人VCで失効依頼・契約取り消し可能 |

### 12.2 重要な原則

1. **決定性の原則**: 秘密鍵による暗号署名がある場合のみ、数学的に決定的な操作が可能
2. **身分証明の重要性**: 身分証明VCは信頼継承の基盤となる
3. **バックアップの必須性**: 秘密鍵のバックアップがない場合、復旧は極めて困難
4. **連絡可能性の限界**: Issuerに連絡できない場合は対応不可能
5. **数学的安全性の限界**: 身分証明と紐づいていないDIDの安全な復旧は不可能
6. **本人死亡時の特性**: 秘密鍵が使用不可能なため、VC失効が不完全でも損害は極めて限定的
7. **被後見人保護の特性**: 後見人VCにより法的保護と技術的管理を両立、Verifierの後見確認フローが重要

### 12.3 Holderへの推奨事項

```
必須:
✅ 最初に身分証明VCを取得する
✅ 秘密鍵を複数箇所にバックアップ
✅ 全Issuerの連絡先を記録

推奨:
✅ 定期的にDIDを更新（1年ごと）
✅ マルチデバイス対応を活用
✅ 緊急時の対応フローを事前確認

避けるべき:
❌ バックアップなしで秘密鍵を保管
❌ 身分証明VCなしで他のVCを取得
❌ 同じ秘密鍵を複数デバイスで共有
```
